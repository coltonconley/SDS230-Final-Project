---
title: "SDS230_Final_Project"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

###Introduction 
This project will examine data from Fama & French 1992 which provides information on the average firm size, monthly return, and beta (?) for 49 different industries. The questions of the project are two-fold: First, we wsih to examine how significant is each variable in predicting returns according to CAPM. Second, we wish to see if there is a difference between CAPM predictions and the actual data through various statistical comparisons including t-tests and permutation tests. 

The purpose of this project will be to examine the hypothesis of the Capital Asset Pricing Model (CAPM) which suggests that alpha (define) can not be generated in a given portfolio or industry. 

###Data
```{r}
library(reshape)
BE <- read.csv("Average BE .csv")
size <- read.csv("Average Firm Size Monthly.csv")
returns <- read.csv("Average Weighted Returns Monthly.csv")
```

The variables we plan to use in this dataset are: 
* Year
* Percent Return 
* Industry (the 49 individual industries as well as composite industries which we will create later during the data cleaning process)
* Average Firm Size - represented in millions of dollars (?)
* Book Equity / Market Equity - *describe the units and description here*

###Data Cleaning

First, across all datasets, when an observation has a firm size, percent return, or beta ratio of zero, the dataset reads -99.99. We will begin by transforming all of these values to zero. 
```{r}
#BE <- BE[complete.cases(BE),]
#size <- size[complete.cases(size),]
#returns <- returns[complete.cases(returns),]
BE[BE== -99.99] <- 0 
size[size == -99.99] <- 0 
returns[returns == -99.99] <- 0 

```

Next, we will reformat the monthly date variables in the Returns and Size dataframes. We will also find yearly averages for the returns and size dataframes to standardize all the dataframes of them by year.
```{r}
size$Year <- substr(size$Year, 1, 4) #Strip off all ofthe month values 
size <- aggregate(.~Year, data = size, mean)

returns$Year <- substr(returns$Year, 1, 4) #Ask what is going on here
returns <- aggregate(.~Year, data = returns, mean)

#Kick off the last row so that we have same sized datasets. 
BE <- BE[1:89,]
size <- size[1:89,]

# separate year from month in "size" dataframe
#size$Year2 <- substr(size$Year, 1, 4)
#size$Month <- substr(size$Year, 5, 6)

# separate year from month in "returns" dataframe
#returns$Year2 <- substr(size$Year, 1, 4)
#returns$Month <- substr(size$Year, 5, 6)

# make an average by year for "size" dataframe

#table(size[size$Year2 == "1926",])


#apply(size[size$Year2 == "1926",], 2, mean)
#size[size$Year2 == "1926",]

#data.frame(size[], apply(size[,c(2:50)],2, mean) )

#table(size$Year2)
```

[INSERT DESCRIPTION HERE]

```{r}
BE <- melt(BE, id = c("Year"))
BE$Ind <- BE$variable
BE$variable <- NULL
BE$BEMERatio <- BE$value
BE$value <- NULL
```

[INSERT DESCRIPTION HERE]

```{r}
size <- melt(size, id = c("Year"))
size$size <- size$value
size$value <- NULL
size$Ind <- size$variable 
size$variable <- NULL 
```

```{r}
returns <- melt(returns, id = c("Year"))
returns$returns <- returns$value
returns$value <- NULL 
returns$Ind <- returns$variable
size$variable <- NULL
```


```{r}
size$YearInd <- paste(size$Year, size$Ind, sep = "_")
BE$YearInd <- paste(BE$Year, BE$Ind, sep = "_")
returns$YearInd <- paste(returns$Year, BE$Ind, sep = "_")
df <- merge(size, BE, by = "YearInd")
df <- merge(df, returns, by = "YearInd")
df$YearInd <- NULL
df$Year.y <- NULL 
df$Ind.y <- NULL 
df$variable <- NULL
df$Year <- NULL
df$Ind.x <- NULL
names(df)[1] <- "Year"
```


Create the composite variables including industry, 20-year period, etc
```{r}

```


###Graphics 

First, we will use a boxplot between our composite industries to examine if there is an observable difference between our composite industries in terms of Beta values
```{r}

```





