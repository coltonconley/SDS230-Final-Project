library(car)
library(leaps)
library(lubridate)
library(rvest)
library(olsrr)
library(corrplot)
library(leaps)
library(car)
source("http://www.reuningscherer.net/s&ds230/Rfuncs/regJDRS.txt")
BE <- read.csv("Average BE .csv")
size <- read.csv("Average Firm Size Monthly.csv")
returns <- read.csv("Average Weighted Returns Monthly.csv")
rf <- read.csv("RP-RF.csv")
#BE <- BE[complete.cases(BE),]
#size <- size[complete.cases(size),]
#returns <- returns[complete.cases(returns),]
BE[BE== -99.99] <- 0
size[size == -99.99] <- 0
returns[returns == -99.99] <- 0
rf[rf == -99.99] <- 0
size$Year <- substr(size$Year, 1, 4) #Strip off all ofthe month values
size <- aggregate(.~Year, data = size, mean)
returns$Year <- substr(returns$Year, 1, 4) #Ask what is going on here
returns <- aggregate(.~Year, data = returns, mean)
rf$Year <- substr(rf$Year,1,4)
rf <- aggregate(.~Year, data= rf, mean)
rf$mktret <- rf$Mkt.RF+rf$RF #This creates the column for market return - done by adding back the risk free rate to the risk free market return
#Kick off the last row so that we have same sized datasets.
BE <- BE[1:89,]
size <- size[1:89,]
rf <- rf[1:89,]
# separate year from month in "size" dataframe
#size$Year2 <- substr(size$Year, 1, 4)
#size$Month <- substr(size$Year, 5, 6)
# separate year from month in "returns" dataframe
#returns$Year2 <- substr(size$Year, 1, 4)
#returns$Month <- substr(size$Year, 5, 6)
# make an average by year for "size" dataframe
#table(size[size$Year2 == "1926",])
#apply(size[size$Year2 == "1926",], 2, mean)
#size[size$Year2 == "1926",]
#data.frame(size[], apply(size[,c(2:50)],2, mean) )
#table(size$Year2)
BE <- melt(BE, id = c("Year"))
BE$Ind <- BE$variable
BE$variable <- NULL
BE$BEMERatio <- BE$value
BE$value <- NULL
size <- melt(size, id = c("Year"))
size$size <- size$value
size$value <- NULL
size$Ind <- size$variable
size$variable <- NULL
returns <- melt(returns, id = c("Year"))
returns$returns <- returns$value
returns$value <- NULL
returns$Ind <- returns$variable
size$variable <- NULL
size$YearInd <- paste(size$Year, size$Ind, sep = "_")
BE$YearInd <- paste(BE$Year, BE$Ind, sep = "_")
returns$YearInd <- paste(returns$Year, BE$Ind, sep = "_")
df <- merge(size, BE, by = "YearInd")
df <- merge(df, returns, by = "YearInd")
df$YearInd <- NULL
df$Year.y <- NULL
df$Ind.y <- NULL
df$variable <- NULL
df$Year <- NULL
df$Ind.x <- NULL
names(df)[1] <- "Year"
df$CompInd <- recode(df$Ind, "'Hlth' = 'Healthcare'; 'MedEq' = 'Healthcare'; 'Drugs' = 'Healthcare'; 'Chems' = 'Healthcare'; 'LabEq' = 'Healthcare'; 'Rubbr' = 'Industrials'; 'BldMt' = 'Industrials'; 'Cnstr' = 'Industrials'; 'Mach' = 'Industrials'; 'ElcEq' = 'Industrials'; 'Autos' = 'Industrials'; 'Aero' = 'Industrials'; 'Ships' = 'Industrials'; 'Mines' = 'Industrials'; 'FabPr' = 'Industrials'; 'Fun' = 'TMT'; 'Telcm' = 'TMT'; 'PerSv' = 'TMT'; 'BusSv' = 'TMT'; 'Softw' = 'TMT'; 'Chips' = 'TMT'; 'Paper' = 'TMT';'Hardw' = 'TMT'; 'Banks' = 'Financials'; 'Insur' = 'Financials'; 'RlEst' = 'Financials'; 'Fin' = 'Financials'; 'Food' = 'Consumer'; 'Soda' = 'Consumer'; 'Beer' = 'Consumer'; 'Smoke' = 'Consumer'; 'Books' = 'Consumer'; 'Clths' = 'Consumer'; 'Hshld' = 'Consumer'; 'Meals' = 'Consumer'; 'Rtail' = 'Consumer'; 'Util' = 'Utilities'; 'Gold' = 'Commodities'; 'Coal' = 'Commodities'; 'Oil' = 'Commodities'; 'Steel' = 'Commodities'; 'Txtls' = 'Commodities'; 'Other' = 'Other'; 'Trans' = 'Other'; 'Boxes' = 'Other'; 'Guns' = 'Other'; 'Whlsl' = 'Other'; 'Agric' = 'Other'; 'Toys' = 'Other'")
df <- merge(df, rf, by = "Year")
df$Year <- as.factor(df$Year)
df$Beta <- NA
for(i in unique(df$Ind)){
temp <- df[df$Ind == i,]
a <- (cov(temp$returns,temp$mktret))/(var(temp$mktret))
df$Beta[df$Ind==i] <- a
}
df <- df[!(df$size == 0),]
View(df)
BE <- read.csv("Average BE .csv")
size <- read.csv("Average Firm Size Monthly.csv")
returns <- read.csv("Average Weighted Returns Monthly.csv")
rf <- read.csv("RP-RF.csv")
#BE <- BE[complete.cases(BE),]
#size <- size[complete.cases(size),]
#returns <- returns[complete.cases(returns),]
BE[BE== -99.99] <- NA
size[size == -99.99] <- NA
returns[returns == -99.99] <- NA
rf[rf == -99.99] <- NA
size$Year <- substr(size$Year, 1, 4) #Strip off all ofthe month values
size <- aggregate(.~Year, data = size, mean)
returns$Year <- substr(returns$Year, 1, 4) #Ask what is going on here
returns <- aggregate(.~Year, data = returns, mean)
rf$Year <- substr(rf$Year,1,4)
rf <- aggregate(.~Year, data= rf, mean)
rf$mktret <- rf$Mkt.RF+rf$RF #This creates the column for market return - done by adding back the risk free rate to the risk free market return
#Kick off the last row so that we have same sized datasets.
BE <- BE[1:89,]
size <- size[1:89,]
rf <- rf[1:89,]
# separate year from month in "size" dataframe
#size$Year2 <- substr(size$Year, 1, 4)
#size$Month <- substr(size$Year, 5, 6)
# separate year from month in "returns" dataframe
#returns$Year2 <- substr(size$Year, 1, 4)
#returns$Month <- substr(size$Year, 5, 6)
# make an average by year for "size" dataframe
#table(size[size$Year2 == "1926",])
#apply(size[size$Year2 == "1926",], 2, mean)
#size[size$Year2 == "1926",]
#data.frame(size[], apply(size[,c(2:50)],2, mean) )
#table(size$Year2)
BE <- melt(BE, id = c("Year"))
BE$Ind <- BE$variable
BE$variable <- NULL
BE$BEMERatio <- BE$value
BE$value <- NULL
size <- melt(size, id = c("Year"))
size$size <- size$value
size$value <- NULL
size$Ind <- size$variable
size$variable <- NULL
returns <- melt(returns, id = c("Year"))
returns$returns <- returns$value
returns$value <- NULL
returns$Ind <- returns$variable
size$variable <- NULL
size$YearInd <- paste(size$Year, size$Ind, sep = "_")
BE$YearInd <- paste(BE$Year, BE$Ind, sep = "_")
returns$YearInd <- paste(returns$Year, BE$Ind, sep = "_")
knitr::opts_chunk$set(echo = TRUE)
library(reshape)
library(car)
library(leaps)
library(lubridate)
library(rvest)
library(olsrr)
library(corrplot)
library(leaps)
library(car)
source("http://www.reuningscherer.net/s&ds230/Rfuncs/regJDRS.txt")
BE <- read.csv("Average BE .csv")
size <- read.csv("Average Firm Size Monthly.csv")
returns <- read.csv("Average Weighted Returns Monthly.csv")
rf <- read.csv("RP-RF.csv")
#BE <- BE[complete.cases(BE),]
#size <- size[complete.cases(size),]
#returns <- returns[complete.cases(returns),]
BE[BE== -99.99] <- NA
size[size == -99.99] <- NA
returns[returns == -99.99] <- NA
rf[rf == -99.99] <- NA
size$Year <- substr(size$Year, 1, 4) #Strip off all ofthe month values
size <- aggregate(.~Year, data = size, mean)
returns$Year <- substr(returns$Year, 1, 4) #Ask what is going on here
returns <- aggregate(.~Year, data = returns, mean)
rf$Year <- substr(rf$Year,1,4)
rf <- aggregate(.~Year, data= rf, mean)
rf$mktret <- rf$Mkt.RF+rf$RF #This creates the column for market return - done by adding back the risk free rate to the risk free market return
#Kick off the last row so that we have same sized datasets.
BE <- BE[1:89,]
size <- size[1:89,]
rf <- rf[1:89,]
# separate year from month in "size" dataframe
#size$Year2 <- substr(size$Year, 1, 4)
#size$Month <- substr(size$Year, 5, 6)
# separate year from month in "returns" dataframe
#returns$Year2 <- substr(size$Year, 1, 4)
#returns$Month <- substr(size$Year, 5, 6)
# make an average by year for "size" dataframe
#table(size[size$Year2 == "1926",])
#apply(size[size$Year2 == "1926",], 2, mean)
#size[size$Year2 == "1926",]
#data.frame(size[], apply(size[,c(2:50)],2, mean) )
#table(size$Year2)
BE <- melt(BE, id = c("Year"))
BE$Ind <- BE$variable
BE$variable <- NULL
BE$BEMERatio <- BE$value
BE$value <- NULL
size <- melt(size, id = c("Year"))
size$size <- size$value
size$value <- NULL
size$Ind <- size$variable
size$variable <- NULL
returns <- melt(returns, id = c("Year"))
returns$returns <- returns$value
returns$value <- NULL
returns$Ind <- returns$variable
size$variable <- NULL
size$YearInd <- paste(size$Year, size$Ind, sep = "_")
BE$YearInd <- paste(BE$Year, BE$Ind, sep = "_")
returns$YearInd <- paste(returns$Year, BE$Ind, sep = "_")
knitr::opts_chunk$set(echo = TRUE)
library(reshape)
library(car)
library(leaps)
library(lubridate)
library(rvest)
library(olsrr)
library(corrplot)
library(leaps)
library(car)
source("http://www.reuningscherer.net/s&ds230/Rfuncs/regJDRS.txt")
BE <- read.csv("Average BE .csv")
size <- read.csv("Average Firm Size Monthly.csv")
returns <- read.csv("Average Weighted Returns Monthly.csv")
rf <- read.csv("RP-RF.csv")
#BE <- BE[complete.cases(BE),]
#size <- size[complete.cases(size),]
#returns <- returns[complete.cases(returns),]
BE[BE== -99.99] <- 0
size[size == -99.99] <- 0
returns[returns == -99.99] <- 0
rf[rf == -99.99] <- 0
size$Year <- substr(size$Year, 1, 4) #Strip off all ofthe month values
size <- aggregate(.~Year, data = size, mean)
returns$Year <- substr(returns$Year, 1, 4) #Ask what is going on here
returns <- aggregate(.~Year, data = returns, mean)
rf$Year <- substr(rf$Year,1,4)
rf <- aggregate(.~Year, data= rf, mean)
rf$mktret <- rf$Mkt.RF+rf$RF #This creates the column for market return - done by adding back the risk free rate to the risk free market return
#Kick off the last row so that we have same sized datasets.
BE <- BE[1:89,]
size <- size[1:89,]
rf <- rf[1:89,]
# separate year from month in "size" dataframe
#size$Year2 <- substr(size$Year, 1, 4)
#size$Month <- substr(size$Year, 5, 6)
# separate year from month in "returns" dataframe
#returns$Year2 <- substr(size$Year, 1, 4)
#returns$Month <- substr(size$Year, 5, 6)
# make an average by year for "size" dataframe
#table(size[size$Year2 == "1926",])
#apply(size[size$Year2 == "1926",], 2, mean)
#size[size$Year2 == "1926",]
#data.frame(size[], apply(size[,c(2:50)],2, mean) )
#table(size$Year2)
BE <- melt(BE, id = c("Year"))
BE$Ind <- BE$variable
BE$variable <- NULL
BE$BEMERatio <- BE$value
BE$value <- NULL
size <- melt(size, id = c("Year"))
size$size <- size$value
size$value <- NULL
size$Ind <- size$variable
size$variable <- NULL
returns <- melt(returns, id = c("Year"))
returns$returns <- returns$value
returns$value <- NULL
returns$Ind <- returns$variable
size$variable <- NULL
size$YearInd <- paste(size$Year, size$Ind, sep = "_")
BE$YearInd <- paste(BE$Year, BE$Ind, sep = "_")
returns$YearInd <- paste(returns$Year, BE$Ind, sep = "_")
df <- merge(size, BE, by = "YearInd")
df <- merge(df, returns, by = "YearInd")
df$YearInd <- NULL
df$Year.y <- NULL
df$Ind.y <- NULL
df$variable <- NULL
df$Year <- NULL
df$Ind.x <- NULL
names(df)[1] <- "Year"
df$CompInd <- recode(df$Ind, "'Hlth' = 'Healthcare'; 'MedEq' = 'Healthcare'; 'Drugs' = 'Healthcare'; 'Chems' = 'Healthcare'; 'LabEq' = 'Healthcare'; 'Rubbr' = 'Industrials'; 'BldMt' = 'Industrials'; 'Cnstr' = 'Industrials'; 'Mach' = 'Industrials'; 'ElcEq' = 'Industrials'; 'Autos' = 'Industrials'; 'Aero' = 'Industrials'; 'Ships' = 'Industrials'; 'Mines' = 'Industrials'; 'FabPr' = 'Industrials'; 'Fun' = 'TMT'; 'Telcm' = 'TMT'; 'PerSv' = 'TMT'; 'BusSv' = 'TMT'; 'Softw' = 'TMT'; 'Chips' = 'TMT'; 'Paper' = 'TMT';'Hardw' = 'TMT'; 'Banks' = 'Financials'; 'Insur' = 'Financials'; 'RlEst' = 'Financials'; 'Fin' = 'Financials'; 'Food' = 'Consumer'; 'Soda' = 'Consumer'; 'Beer' = 'Consumer'; 'Smoke' = 'Consumer'; 'Books' = 'Consumer'; 'Clths' = 'Consumer'; 'Hshld' = 'Consumer'; 'Meals' = 'Consumer'; 'Rtail' = 'Consumer'; 'Util' = 'Utilities'; 'Gold' = 'Commodities'; 'Coal' = 'Commodities'; 'Oil' = 'Commodities'; 'Steel' = 'Commodities'; 'Txtls' = 'Commodities'; 'Other' = 'Other'; 'Trans' = 'Other'; 'Boxes' = 'Other'; 'Guns' = 'Other'; 'Whlsl' = 'Other'; 'Agric' = 'Other'; 'Toys' = 'Other'")
df <- merge(df, rf, by = "Year")
df$Year <- as.factor(df$Year)
df$Beta <- NA
for(i in unique(df$Ind)){
temp <- df[df$Ind == i,]
a <- (cov(temp$returns,temp$mktret))/(var(temp$mktret))
df$Beta[df$Ind==i] <- a
}
View(rf)
boxplot(log(df$size + 1)~df$CompInd, main = "Boxplot of Composite Industry and Size", col = c("red", "blue", "green", "yellow","orange", "magenta", "turquoise", "lime green"), ylab = "Log of Size", las = 2, cex.axis = .8)
plot(df$returns ~ df$Year, main = "Scatterplot of Year versus Average Yearly Returns", pch = 24, col = "blue", xlab = "Year", ylab = "Average Yearly Returns")
View(BE)
View(df)
View(size)
?rep
View(df)
plot(df$returns ~ df$Year, main = "Scatterplot of Year versus Average Yearly Returns", pch = 24, col = "blue", xlab = "Year", ylab = "Average Yearly Returns")
write.csv(df, "finaldf.csv")
knitr::opts_chunk$set(echo = TRUE)
aggdf <- read.csv("CompInd Returns.csv")
View(aggdf)
aggdf <- melt(aggdf, id = c("Row.Labels"))
library(reshape)
aggdf <- melt(aggdf, id = c("Row.Labels"))
View(aggdf)
BE$CompInd <- BE$variable
BE$variable <- NULL
knitr::opts_chunk$set(echo = TRUE)
library(reshape)
library(car)
library(leaps)
library(lubridate)
library(rvest)
library(olsrr)
library(corrplot)
library(leaps)
library(car)
source("http://www.reuningscherer.net/s&ds230/Rfuncs/regJDRS.txt")
BE <- read.csv("Average BE .csv")
size <- read.csv("Average Firm Size Monthly.csv")
returns <- read.csv("Average Weighted Returns Monthly.csv")
rf <- read.csv("RP-RF.csv")
#BE <- BE[complete.cases(BE),]
#size <- size[complete.cases(size),]
#returns <- returns[complete.cases(returns),]
BE[BE== -99.99] <- 0
size[size == -99.99] <- 0
returns[returns == -99.99] <- 0
rf[rf == -99.99] <- 0
size$Year <- substr(size$Year, 1, 4) #Strip off all ofthe month values
size <- aggregate(.~Year, data = size, mean)
returns$Year <- substr(returns$Year, 1, 4) #Ask what is going on here
returns <- aggregate(.~Year, data = returns, mean)
rf$Year <- substr(rf$Year,1,4)
rf <- aggregate(.~Year, data= rf, mean)
rf$mktret <- rf$Mkt.RF+rf$RF #This creates the column for market return - done by adding back the risk free rate to the risk free market return
#Kick off the last row so that we have same sized datasets.
BE <- BE[1:89,]
size <- size[1:89,]
rf <- rf[1:89,]
# separate year from month in "size" dataframe
#size$Year2 <- substr(size$Year, 1, 4)
#size$Month <- substr(size$Year, 5, 6)
# separate year from month in "returns" dataframe
#returns$Year2 <- substr(size$Year, 1, 4)
#returns$Month <- substr(size$Year, 5, 6)
# make an average by year for "size" dataframe
#table(size[size$Year2 == "1926",])
#apply(size[size$Year2 == "1926",], 2, mean)
#size[size$Year2 == "1926",]
#data.frame(size[], apply(size[,c(2:50)],2, mean) )
#table(size$Year2)
BE <- melt(BE, id = c("Year"))
BE$Ind <- BE$variable
BE$variable <- NULL
BE$BEMERatio <- BE$value
BE$value <- NULL
size <- melt(size, id = c("Year"))
size$size <- size$value
size$value <- NULL
size$Ind <- size$variable
size$variable <- NULL
returns <- melt(returns, id = c("Year"))
returns$returns <- returns$value
returns$value <- NULL
returns$Ind <- returns$variable
size$variable <- NULL
size$YearInd <- paste(size$Year, size$Ind, sep = "_")
BE$YearInd <- paste(BE$Year, BE$Ind, sep = "_")
returns$YearInd <- paste(returns$Year, BE$Ind, sep = "_")
df <- merge(size, BE, by = "YearInd")
df <- merge(df, returns, by = "YearInd")
df$YearInd <- NULL
df$Year.y <- NULL
df$Ind.y <- NULL
df$variable <- NULL
df$Year <- NULL
df$Ind.x <- NULL
names(df)[1] <- "Year"
df$CompInd <- recode(df$Ind, "'Hlth' = 'Healthcare'; 'MedEq' = 'Healthcare'; 'Drugs' = 'Healthcare'; 'Chems' = 'Healthcare'; 'LabEq' = 'Healthcare'; 'Rubbr' = 'Industrials'; 'BldMt' = 'Industrials'; 'Cnstr' = 'Industrials'; 'Mach' = 'Industrials'; 'ElcEq' = 'Industrials'; 'Autos' = 'Industrials'; 'Aero' = 'Industrials'; 'Ships' = 'Industrials'; 'Mines' = 'Industrials'; 'FabPr' = 'Industrials'; 'Fun' = 'TMT'; 'Telcm' = 'TMT'; 'PerSv' = 'TMT'; 'BusSv' = 'TMT'; 'Softw' = 'TMT'; 'Chips' = 'TMT'; 'Paper' = 'TMT';'Hardw' = 'TMT'; 'Banks' = 'Financials'; 'Insur' = 'Financials'; 'RlEst' = 'Financials'; 'Fin' = 'Financials'; 'Food' = 'Consumer'; 'Soda' = 'Consumer'; 'Beer' = 'Consumer'; 'Smoke' = 'Consumer'; 'Books' = 'Consumer'; 'Clths' = 'Consumer'; 'Hshld' = 'Consumer'; 'Meals' = 'Consumer'; 'Rtail' = 'Consumer'; 'Util' = 'Utilities'; 'Gold' = 'Commodities'; 'Coal' = 'Commodities'; 'Oil' = 'Commodities'; 'Steel' = 'Commodities'; 'Txtls' = 'Commodities'; 'Other' = 'Other'; 'Trans' = 'Other'; 'Boxes' = 'Other'; 'Guns' = 'Other'; 'Whlsl' = 'Other'; 'Agric' = 'Other'; 'Toys' = 'Other'")
df <- merge(df, rf, by = "Year")
df$Year <- as.factor(df$Year)
df$Beta <- NA
for(i in unique(df$Ind)){
temp <- df[df$Ind == i,]
a <- (cov(temp$returns,temp$mktret))/(var(temp$mktret))
df$Beta[df$Ind==i] <- a
}
write.csv(df, "finaldf.csv")
aggdf <- read.csv("CompInd Returns.csv")
aggdf <- melt(aggdf, id = c("Row.Labels"))
View(aggdf)
aggdf$CompInd <- aggdf$variable
aggdf$variable <- NULL
aggdf$AvgReturns <- aggdf$value
BE$value <- NULL
aggdf$Year <- aggdf$Row.Labels
aggdf$Row.Labels <- NULL
BE$value <- NULL
aggdf$value <- NULL
plot(aggdf$returns ~ df$Year, main = "Scatterplot of Year versus Average Yearly Returns", pch = 24, col = "blue", xlab = "Year", ylab = "Average Yearly Returns")
plot(aggdf$returns ~ aggdf$Year, main = "Scatterplot of Year versus Average Yearly Returns", pch = 24, col = "blue", xlab = "Year", ylab = "Average Yearly Returns")
plot(aggdf$AvgReturns ~ aggdf$Year, main = "Scatterplot of Year versus Average Yearly Returns", pch = 24, col = "blue", xlab = "Year", ylab = "Average Yearly Returns")
plot(aggdf$AvgReturns ~ aggdf$Year, main = "Scatterplot of Year versus Average Yearly Returns", pch = 24, col = "blue", xlab = "Year", ylab = "Average Yearly Returns", col = levels(aggdf$CompInd))
plot(aggdf$AvgReturns ~ aggdf$Year, main = "Scatterplot of Year versus Average Yearly Returns", pch = 24, col = "blue", xlab = "Year", ylab = "Average Yearly Returns", col = c(1:9))
plot(aggdf$AvgReturns ~ aggdf$Year, main = "Scatterplot of Year versus Average Yearly Returns", pch = 24, col = "blue", xlab = "Year", ylab = "Average Yearly Returns", col = c(1:5))
plot(aggdf$AvgReturns ~ aggdf$Year, main = "Scatterplot of Year versus Average Yearly Returns", pch = 24, col = "blue", xlab = "Year", ylab = "Average Yearly Returns")
plot(aggdf$AvgReturns ~ aggdf$Year, main = "Scatterplot of Year versus Average Yearly Returns", pch = 24, col = levels(aggdf$CompInd), xlab = "Year", ylab = "Average Yearly Returns")
plot(aggdf$AvgReturns ~ aggdf$Year, main = "Scatterplot of Year versus Average Yearly Returns", pch = 24, col = c(1:9), xlab = "Year", ylab = "Average Yearly Returns")
plot(aggdf$AvgReturns$Commodities ~ aggdf$Year, main = "Scatterplot of Year versus Average Yearly Returns", pch = 24, col = c(1:9), xlab = "Year", ylab = "Average Yearly Returns")
plot(aggdf$AvgReturns ~ aggdf$Year, main = "Scatterplot of Year versus Average Yearly Returns", pch = 24, col = c(1:9), xlab = "Year", ylab = "Average Yearly Returns")
aggdf$AvgReturns[aggdf$CompInd = "Commodities",]
aggdf$AvgReturns[aggdf$CompInd == "Commodities",]
plot(aggdf$AvgReturns[aggdf$CompInd == "Commodities",] ~ aggdf$Year[aggdf$CompInd == "Commodities",], main = "Scatterplot of Year versus Average Yearly Returns", pch = 24, col = c(1:9), xlab = "Year", ylab = "Average Yearly Returns")
plot(aggdf$AvgReturns[,aggdf$CompInd == "Commodities"] ~ aggdf$Year[,aggdf$CompInd == "Commodities"], main = "Scatterplot of Year versus Average Yearly Returns", pch = 24, col = c(1:9), xlab = "Year", ylab = "Average Yearly Returns")
plot(aggdf$AvgReturns[aggdf$CompInd == "Commodities"] ~ aggdf$Year[aggdf$CompInd == "Commodities"], main = "Scatterplot of Year versus Average Yearly Returns", pch = 24, col = c(1:9), xlab = "Year", ylab = "Average Yearly Returns")
plot(aggdf$AvgReturns[aggdf$CompInd == "Commodities"] ~ aggdf$Year[aggdf$CompInd == "Commodities"], main = "Scatterplot of Year versus Average Yearly Returns", pch = 24, col = "green", xlab = "Year", ylab = "Average Yearly Returns")
knitr::opts_chunk$set(echo = TRUE)
library(reshape)
library(car)
library(leaps)
library(lubridate)
library(rvest)
library(olsrr)
library(corrplot)
library(leaps)
library(car)
source("http://www.reuningscherer.net/s&ds230/Rfuncs/regJDRS.txt")
BE <- read.csv("Average BE .csv")
size <- read.csv("Average Firm Size Monthly.csv")
returns <- read.csv("Average Weighted Returns Monthly.csv")
rf <- read.csv("RP-RF.csv")
#BE <- BE[complete.cases(BE),]
#size <- size[complete.cases(size),]
#returns <- returns[complete.cases(returns),]
BE[BE== -99.99] <- 0
size[size == -99.99] <- 0
returns[returns == -99.99] <- 0
rf[rf == -99.99] <- 0
size$Year <- substr(size$Year, 1, 4) #Strip off all ofthe month values
size <- aggregate(.~Year, data = size, mean)
returns$Year <- substr(returns$Year, 1, 4) #Ask what is going on here
returns <- aggregate(.~Year, data = returns, mean)
rf$Year <- substr(rf$Year,1,4)
rf <- aggregate(.~Year, data= rf, mean)
rf$mktret <- rf$Mkt.RF+rf$RF #This creates the column for market return - done by adding back the risk free rate to the risk free market return
#Kick off the last row so that we have same sized datasets.
BE <- BE[1:89,]
size <- size[1:89,]
rf <- rf[1:89,]
# separate year from month in "size" dataframe
#size$Year2 <- substr(size$Year, 1, 4)
#size$Month <- substr(size$Year, 5, 6)
# separate year from month in "returns" dataframe
#returns$Year2 <- substr(size$Year, 1, 4)
#returns$Month <- substr(size$Year, 5, 6)
# make an average by year for "size" dataframe
#table(size[size$Year2 == "1926",])
#apply(size[size$Year2 == "1926",], 2, mean)
#size[size$Year2 == "1926",]
#data.frame(size[], apply(size[,c(2:50)],2, mean) )
#table(size$Year2)
BE <- melt(BE, id = c("Year"))
BE$Ind <- BE$variable
BE$variable <- NULL
BE$BEMERatio <- BE$value
BE$value <- NULL
size <- melt(size, id = c("Year"))
size$size <- size$value
size$value <- NULL
size$Ind <- size$variable
size$variable <- NULL
returns <- melt(returns, id = c("Year"))
returns$returns <- returns$value
returns$value <- NULL
returns$Ind <- returns$variable
size$variable <- NULL
size$YearInd <- paste(size$Year, size$Ind, sep = "_")
BE$YearInd <- paste(BE$Year, BE$Ind, sep = "_")
returns$YearInd <- paste(returns$Year, BE$Ind, sep = "_")
df <- merge(size, BE, by = "YearInd")
df <- merge(df, returns, by = "YearInd")
df$YearInd <- NULL
df$Year.y <- NULL
df$Ind.y <- NULL
df$variable <- NULL
df$Year <- NULL
df$Ind.x <- NULL
names(df)[1] <- "Year"
df$CompInd <- recode(df$Ind, "'Hlth' = 'Healthcare'; 'MedEq' = 'Healthcare'; 'Drugs' = 'Healthcare'; 'Chems' = 'Healthcare'; 'LabEq' = 'Healthcare'; 'Rubbr' = 'Industrials'; 'BldMt' = 'Industrials'; 'Cnstr' = 'Industrials'; 'Mach' = 'Industrials'; 'ElcEq' = 'Industrials'; 'Autos' = 'Industrials'; 'Aero' = 'Industrials'; 'Ships' = 'Industrials'; 'Mines' = 'Industrials'; 'FabPr' = 'Industrials'; 'Fun' = 'TMT'; 'Telcm' = 'TMT'; 'PerSv' = 'TMT'; 'BusSv' = 'TMT'; 'Softw' = 'TMT'; 'Chips' = 'TMT'; 'Paper' = 'TMT';'Hardw' = 'TMT'; 'Banks' = 'Financials'; 'Insur' = 'Financials'; 'RlEst' = 'Financials'; 'Fin' = 'Financials'; 'Food' = 'Consumer'; 'Soda' = 'Consumer'; 'Beer' = 'Consumer'; 'Smoke' = 'Consumer'; 'Books' = 'Consumer'; 'Clths' = 'Consumer'; 'Hshld' = 'Consumer'; 'Meals' = 'Consumer'; 'Rtail' = 'Consumer'; 'Util' = 'Utilities'; 'Gold' = 'Commodities'; 'Coal' = 'Commodities'; 'Oil' = 'Commodities'; 'Steel' = 'Commodities'; 'Txtls' = 'Commodities'; 'Other' = 'Other'; 'Trans' = 'Other'; 'Boxes' = 'Other'; 'Guns' = 'Other'; 'Whlsl' = 'Other'; 'Agric' = 'Other'; 'Toys' = 'Other'")
df <- merge(df, rf, by = "Year")
df$Year <- as.factor(df$Year)
df$Beta <- NA
for(i in unique(df$Ind)){
temp <- df[df$Ind == i,]
a <- (cov(temp$returns,temp$mktret))/(var(temp$mktret))
df$Beta[df$Ind==i] <- a
}
write.csv(df, "finaldf.csv")
aggdf <- read.csv("CompInd Returns.csv")
aggdf <- melt(aggdf, id = c("Row.Labels"))
aggdf$CompInd <- aggdf$variable
aggdf$variable <- NULL
aggdf$AvgReturns <- aggdf$value
aggdf$value <- NULL
aggdf$Year <- aggdf$Row.Labels
aggdf$Row.Labels <- NULL
boxplot(log(df$size + 1)~df$CompInd, main = "Boxplot of Composite Industry and Size", col = c("red", "blue", "green", "yellow","orange", "magenta", "turquoise", "lime green"), ylab = "Log of Size", las = 2, cex.axis = .8)
qqPlot(df$returns~df$CompInd)
qqPlot(log(df$size+1)~df$CompInd) #Given that size is in dollars, we found that a log transformation would be valuable to preserving normality.
qqPlot(df$BEMERatio~df$CompInd)
plot(aggdf$AvgReturns[aggdf$CompInd == "TMT"] ~ aggdf$Year[aggdf$CompInd == "TMT"], main = "Scatterplot of Year versus Average Yearly Returns", pch = 24, col = "green", xlab = "Year", ylab = "Average Yearly Returns")
plot(aggdf$AvgReturns[aggdf$CompInd == "Commodities"] ~ aggdf$Year[aggdf$CompInd == "Commodities"], main = "Scatterplot of Year versus Average Yearly Returns", pch = 24, col = "green", xlab = "Year", ylab = "Average Yearly Returns")
plot(df$returns ~ df$year)
plot(df$returns ~ df$year)
plot(df$returns ~ df$Year)
plot(df$returns ~ df$Year, col=(1:9))
plot(df$returns ~ df$Year, col=(1:90))
plot(df$returns ~ df$Year, col= "blue")
#Figure out graphical parameters
qqPlot(df$returns~df$CompInd)
qqPlot(log(df$size+1)~df$CompInd) #Given that size is in dollars, we found that a log transformation would be valuable to preserving normality.
qqPlot(df$BEMERatio~df$CompInd)
